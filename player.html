  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Director Web Player</title>
      <style>
          * {
              box-sizing: border-box;
              margin: 0;
              padding: 0;
          }

          body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              background: #1a1a2e;
              color: #eee;
              min-height: 100vh;
              display: flex;
              flex-direction: column;
          }

          header {
              padding: 1rem;
              background: #16213e;
              text-align: center;
          }

          h1 {
              font-size: 1.5rem;
              margin-bottom: 0.5rem;
          }

          #stage-container {
              flex: 1;
              display: flex;
              align-items: center;
              justify-content: center;
              background: #0f0f23;
              position: relative;
              min-height: 400px;
          }

          #drop-zone {
              position: absolute;
              inset: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              flex-direction: column;
              gap: 1rem;
              border: 3px dashed #444;
              margin: 1rem;
              border-radius: 8px;
              transition: all 0.2s;
          }

          #drop-zone.drag-over {
              border-color: #4a9eff;
              background: rgba(74, 158, 255, 0.1);
          }

          #drop-zone.hidden {
              display: none;
          }

          .controls {
              padding: 1rem;
              background: #16213e;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 1rem;
              flex-wrap: wrap;
          }

          button {
              padding: 0.5rem 1.5rem;
              font-size: 1rem;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              background: #4a9eff;
              color: white;
              transition: background 0.2s;
          }

          button:hover {
              background: #3a8eef;
          }

          button:disabled {
              background: #555;
              cursor: not-allowed;
          }

          #frame-display {
              font-family: monospace;
              min-width: 120px;
              text-align: center;
          }

          input[type="file"] {
              display: none;
          }

          #status {
              padding: 0.5rem 1rem;
              background: #0d1b2a;
              text-align: center;
              font-size: 0.875rem;
              color: #888;
          }
      </style>
  </head>
  <body>
      <header>
          <h1>Director Web Player</h1>
          <p>Load a .dir, .dcr, or .cst file to play</p>
      </header>

      <div id="stage-container">
          <div id="drop-zone">
              <p>Drag & drop a Director file here</p>
              <p>or</p>
              <button id="browse-btn">Browse Files</button>
              <input type="file" id="file-input" accept=".dir,.dcr,.dxr,.cst,.cct,.cxt">
          </div>
      </div>

      <div class="controls">
          <button id="prev-btn" disabled>⏮ Prev</button>
          <button id="play-btn" disabled>▶ Play</button>
          <button id="stop-btn" disabled>⏹ Stop</button>
          <button id="next-btn" disabled>Next ⏭</button>
          <span id="frame-display">Frame: --/--</span>
      </div>

      <div id="status">Ready - Awaiting file</div>

      <!-- Load as ES module -->
      <script type="module">
          // Import the player from compiled output
          import { MoviePlayer, PlaybackState } from './build/js/index.js';

          // DOM elements
          const stageContainer = document.getElementById('stage-container');
          const dropZone = document.getElementById('drop-zone');
          const fileInput = document.getElementById('file-input');
          const browseBtn = document.getElementById('browse-btn');
          const playBtn = document.getElementById('play-btn');
          const stopBtn = document.getElementById('stop-btn');
          const prevBtn = document.getElementById('prev-btn');
          const nextBtn = document.getElementById('next-btn');
          const frameDisplay = document.getElementById('frame-display');
          const status = document.getElementById('status');

          // Create player instance
          const player = new MoviePlayer();

          // Initialize player
          async function init() {
              try {
                  status.textContent = 'Initializing WASM...';
                  await player.init(stageContainer, './build/director.wasm');
                  status.textContent = 'Ready - Awaiting file';
                  console.log('Player initialized, version:', player.getStage());
              } catch (err) {
                  status.textContent = `Error: ${err.message}`;
                  console.error('Init failed:', err);
              }
          }

          // Load a file
          async function loadFile(file) {
              try {
                  status.textContent = `Loading ${file.name}...`;
                  dropZone.classList.add('hidden');

                  const success = await player.loadFromFile(file);

                  if (success) {
                      status.textContent = `Loaded: ${file.name}`;
                      enableControls(true);
                      updateFrameDisplay();

                      // Set up frame event
                      player.on('frame', (frameNum) => {
                          updateFrameDisplay();
                      });
                  } else {
                      status.textContent = 'Failed to load file';
                      dropZone.classList.remove('hidden');
                  }
              } catch (err) {
                  status.textContent = `Error: ${err.message}`;
                  dropZone.classList.remove('hidden');
                  console.error('Load failed:', err);
              }
          }

          // Update frame counter
          function updateFrameDisplay() {
              const current = player.currentFrame;
              const total = player.frameCount || '??';
              frameDisplay.textContent = `Frame: ${current}/${total}`;
          }

          // Enable/disable controls
          function enableControls(enabled) {
              playBtn.disabled = !enabled;
              stopBtn.disabled = !enabled;
              prevBtn.disabled = !enabled;
              nextBtn.disabled = !enabled;
          }

          // Update play button text
          function updatePlayButton() {
              if (player.state === PlaybackState.Playing) {
                  playBtn.textContent = '⏸ Pause';
              } else {
                  playBtn.textContent = '▶ Play';
              }
          }

          // Event listeners
          browseBtn.addEventListener('click', () => fileInput.click());

          fileInput.addEventListener('change', (e) => {
              const file = e.target.files[0];
              if (file) loadFile(file);
          });

          // Drag and drop
          dropZone.addEventListener('dragover', (e) => {
              e.preventDefault();
              dropZone.classList.add('drag-over');
          });

          dropZone.addEventListener('dragleave', () => {
              dropZone.classList.remove('drag-over');
          });

          dropZone.addEventListener('drop', (e) => {
              e.preventDefault();
              dropZone.classList.remove('drag-over');
              const file = e.dataTransfer.files[0];
              if (file) loadFile(file);
          });

          // Playback controls
          playBtn.addEventListener('click', () => {
              if (player.state === PlaybackState.Playing) {
                  player.pause();
              } else {
                  player.play();
              }
              updatePlayButton();
          });

          stopBtn.addEventListener('click', () => {
              player.stop();
              updatePlayButton();
              updateFrameDisplay();
          });

          prevBtn.addEventListener('click', () => {
              player.prevFrame();
          });

          nextBtn.addEventListener('click', () => {
              player.nextFrame();
          });

          // Keyboard shortcuts
          document.addEventListener('keydown', (e) => {
              if (!player.isLoaded) return;

              switch (e.code) {
                  case 'Space':
                      e.preventDefault();
                      playBtn.click();
                      break;
                  case 'ArrowLeft':
                      player.prevFrame();
                      break;
                  case 'ArrowRight':
                      player.nextFrame();
                      break;
                  case 'Home':
                      player.gotoFrame(1);
                      break;
                  case 'End':
                      player.gotoFrame(player.frameCount);
                      break;
              }
          });

          // Start
          init();
      </script>
  </body>
  </html>